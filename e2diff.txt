diff -urN e2fsprogs-1.32/configure e2fsprogs-1.32-darwin/configure
--- e2fsprogs-1.32/configure	Sat Nov  9 12:48:10 2002
+++ e2fsprogs-1.32-darwin/configure	Thu Mar  6 20:38:05 2003
@@ -1212,6 +1212,10 @@
 	BSDLIB_CMT=
 	MAKEFILE_BSDLIB=$srcdir/lib/Makefile.bsd-lib
 	LIB_EXT=.so
+	if [ `uname -s` == Darwin ]; then
+		MAKEFILE_BSDLIB=$srcdir/lib/Makefile.darwin-lib
+		LIB_EXT=.dylib
+	fi
 	echo "Enabling BSD shared libraries"
 fi
 
diff -urN e2fsprogs-1.32/configure.in e2fsprogs-1.32-darwin/configure.in
--- e2fsprogs-1.32/configure.in	Sat Nov  9 12:48:10 2002
+++ e2fsprogs-1.32-darwin/configure.in	Thu Mar  6 20:38:05 2003
@@ -258,6 +258,12 @@
 	BSDLIB_CMT=
 	MAKEFILE_BSDLIB=$srcdir/lib/Makefile.bsd-lib
 	LIB_EXT=.so
+	[case "$host_os" in
+	darwin.*)
+		MAKEFILE_BSDLIB=$srcdir/lib/Makefile.darwin-lib
+		LIB_EXT=.dylib
+	;;
+	esac]
 	echo "Enabling BSD shared libraries"
 fi
 ,
diff -urN e2fsprogs-1.32/e2fsck/iscan.c e2fsprogs-1.32-darwin/e2fsck/iscan.c
--- e2fsprogs-1.32/e2fsck/iscan.c	Sun Feb 24 15:03:58 2002
+++ e2fsprogs-1.32-darwin/e2fsck/iscan.c	Thu Mar  6 20:38:05 2003
@@ -19,7 +19,9 @@
 #include <mntent.h>
 #endif
 #include <sys/ioctl.h>
+#ifdef HAVE_MALLOC_H
 #include <malloc.h>
+#endif
 
 #include "et/com_err.h"
 #include "e2fsck.h"
diff -urN e2fsprogs-1.32/e2fsck/pass1.c e2fsprogs-1.32-darwin/e2fsck/pass1.c
--- e2fsprogs-1.32/e2fsck/pass1.c	Fri Nov  8 10:37:28 2002
+++ e2fsprogs-1.32-darwin/e2fsck/pass1.c	Thu Mar  6 20:38:05 2003
@@ -162,7 +162,7 @@
  * Incredibly, libc5 doesn't appear to have strnlen.  So we have to
  * provide our own.
  */
-static int strnlen(const char * s, int count)
+int strnlen(const char * s, int count)
 {
 	const char *cp = s;
 
diff -urN e2fsprogs-1.32/e2fsck/scantest.c e2fsprogs-1.32-darwin/e2fsck/scantest.c
--- e2fsprogs-1.32/e2fsck/scantest.c	Sun Feb 24 15:03:59 2002
+++ e2fsprogs-1.32-darwin/e2fsck/scantest.c	Thu Mar  6 20:38:05 2003
@@ -15,7 +15,9 @@
 #include <mntent.h>
 #endif
 #include <sys/ioctl.h>
+#ifdef HAVE_MALLOC_H
 #include <malloc.h>
+#endif
 #include <sys/resource.h>
 
 #include "et/com_err.h"
diff -urN e2fsprogs-1.32/e2fsck/unix.c e2fsprogs-1.32-darwin/e2fsck/unix.c
--- e2fsprogs-1.32/e2fsck/unix.c	Fri Nov  8 17:42:33 2002
+++ e2fsprogs-1.32-darwin/e2fsck/unix.c	Thu Mar  6 20:38:05 2003
@@ -34,7 +34,9 @@
 #include <mntent.h>
 #endif
 #include <sys/ioctl.h>
+#ifdef HAVE_MALLOC_H
 #include <malloc.h>
+#endif
 
 #include "et/com_err.h"
 #include "e2fsck.h"
diff -urN e2fsprogs-1.32/lib/Makefile.darwin-lib e2fsprogs-1.32-darwin/lib/Makefile.darwin-lib
--- e2fsprogs-1.32/lib/Makefile.darwin-lib	Wed Dec 31 18:00:00 1969
+++ e2fsprogs-1.32-darwin/lib/Makefile.darwin-lib	Thu Mar  6 20:38:05 2003
@@ -0,0 +1,44 @@
+#
+# This is a Makefile stub which handles the creation of Darwin BSD shared
+# libraries.
+#
+# In order to use this stub, the following makefile variables must be defined.
+# 
+# BSDLIB_VERSION = 1.0
+# BSDLIB_IMAGE = libce
+# BSDLIB_MYDIR = et
+# BSDLIB_INSTALL_DIR = $(SHLIBDIR)
+#
+
+all:: pic image
+
+subdirs:: pic
+
+pic:
+	mkdir pic
+
+BSD_LIB = $(BSDLIB_IMAGE).$(BSDLIB_VERSION).dylib
+
+image:		$(BSD_LIB)
+
+$(BSD_LIB): $(OBJS)
+	(cd pic; $(CC) -dynamiclib -compatibility_version 1.0 -current_version $(BSDLIB_VERSION) \
+		-flat_namespace -undefined warning -o $(BSD_LIB) $(OBJS))
+	$(MV) pic/$(BSD_LIB) .
+	$(RM) -f ../$(BSD_LIB)
+	$(LN) $(BSD_LIB) ../$(BSD_LIB)
+	$(LN) ../$(BSD_LIB) ../$(BSDLIB_IMAGE).dylib
+
+install-shlibs install:: $(BSD_LIB)
+	$(INSTALL_PROGRAM) $(BSD_LIB) \
+		$(DESTDIR)$(BSDLIB_INSTALL_DIR)/$(BSD_LIB)
+	-$(LDCONFIG)
+
+uninstall-shlibs uninstall::
+	$(RM) -f $(DESTDIR)$(BSDLIB_INSTALL_DIR)/$(BSD_LIB)
+
+clean::
+	$(RM) -rf pic
+	$(RM) -f $(BSD_LIB)
+	$(RM) -f ../$(BSD_LIB)
+	$(RM) -f ../$(BSDLIB_IMAGE).dylib
diff -urN e2fsprogs-1.32/lib/ext2fs/getsize.c e2fsprogs-1.32-darwin/lib/ext2fs/getsize.c
--- e2fsprogs-1.32/lib/ext2fs/getsize.c	Sun Feb 24 15:03:59 2002
+++ e2fsprogs-1.32-darwin/lib/ext2fs/getsize.c	Thu Mar  6 20:40:18 2003
@@ -29,6 +29,13 @@
 #include <sys/disklabel.h>
 #endif /* HAVE_SYS_DISKLABEL_H */
 
+#ifdef APPLE_DARWIN
+#include <sys/ioctl.h>
+#include <sys/disk.h>
+
+#define BLKGETSIZE DKIOCGETBLOCKCOUNT32
+#endif /* APPLE_DARWIN */
+
 #if defined(__linux__) && defined(_IO) && !defined(BLKGETSIZE)
 #define BLKGETSIZE _IO(0x12,96)	/* return device size */
 #endif
diff -urN e2fsprogs-1.32/lib/uuid/Makefile.in e2fsprogs-1.32-darwin/lib/uuid/Makefile.in
--- e2fsprogs-1.32/lib/uuid/Makefile.in	Mon Jul 15 22:50:03 2002
+++ e2fsprogs-1.32-darwin/lib/uuid/Makefile.in	Thu Mar  6 20:38:05 2003
@@ -163,6 +163,7 @@
 #
 ../../lib/libuuid.a: libuuid.a
 ../../lib/libuuid.so: image
+../../lib/libuuid.dylib: image
 
 # +++ Dependency line eater +++
 # 
diff -urN e2fsprogs-1.32/misc/fsck.c e2fsprogs-1.32-darwin/misc/fsck.c
--- e2fsprogs-1.32/misc/fsck.c	Thu Oct 31 02:51:10 2002
+++ e2fsprogs-1.32-darwin/misc/fsck.c	Thu Mar  6 20:38:05 2003
@@ -50,7 +50,9 @@
 #if HAVE_ERRNO_H
 #include <errno.h>
 #endif
+#ifdef HAVE_MALLOC_H
 #include <malloc.h>
+#endif
 
 #include "../version.h"
 #include "nls-enable.h"
